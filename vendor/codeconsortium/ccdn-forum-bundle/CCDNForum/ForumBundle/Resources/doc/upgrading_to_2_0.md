Upgrading CCDNForum ForumBundle to 1.1.2
========================================

Run this SQL to upgrade.

```sql
set foreign_key_checks=0;

CREATE TABLE cc_forum_forum (
	id INT AUTO_INCREMENT NOT NULL, name VARCHAR(255) NOT NULL,
	read_authorised_roles LONGTEXT DEFAULT NULL COMMENT '(DC2Type:array)',
	UNIQUE INDEX UNIQ_2A09092E5E237E06 (name),
	PRIMARY KEY(id)
) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;



ALTER TABLE CC_Forum_Board DROP INDEX UNIQ_CE330F5AADF87F41, ADD INDEX IDX_F7749CA4CD83D7D (fk_last_post_id);
ALTER TABLE CC_Forum_Board
	ADD read_authorised_roles LONGTEXT DEFAULT NULL COMMENT '(DC2Type:array)',
	ADD topic_create_authorised_roles LONGTEXT DEFAULT NULL COMMENT '(DC2Type:array)',
	ADD topic_reply_authorised_roles LONGTEXT DEFAULT NULL COMMENT '(DC2Type:array)',
	CHANGE name name VARCHAR(255) NOT NULL;
ALTER TABLE CC_Forum_Category
	ADD fk_forum_id INT DEFAULT NULL,
	ADD read_authorised_roles LONGTEXT DEFAULT NULL COMMENT '(DC2Type:array)',
	CHANGE name name VARCHAR(255) NOT NULL;



ALTER TABLE CC_Forum_Category ADD CONSTRAINT FK_D30C0E0C1BE4F90E FOREIGN KEY (fk_forum_id) REFERENCES cc_forum_forum (id) ON DELETE SET NULL;
CREATE INDEX IDX_D30C0E0C1BE4F90E ON CC_Forum_Category (fk_forum_id);
ALTER TABLE CC_Forum_Post DROP FOREIGN KEY FK_3606FFC72AF06A63;
ALTER TABLE CC_Forum_Post DROP FOREIGN KEY FK_3606FFC746B4308F;
ALTER TABLE CC_Forum_Post DROP FOREIGN KEY FK_3606FFC74F5AE4DA;
ALTER TABLE CC_Forum_Post DROP FOREIGN KEY FK_3606FFC7602E9349;
ALTER TABLE CC_Forum_Post DROP FOREIGN KEY FK_3606FFC7CEB06035;

DROP INDEX IDX_3606FFC72AF06A63 ON CC_Forum_Post;
DROP INDEX IDX_3606FFC7602E9349 ON CC_Forum_Post;



ALTER TABLE CC_Forum_Post
	ADD fk_unlocked_by_user_id INT DEFAULT NULL,
	ADD unlocked_until_date DATETIME DEFAULT NULL,
	DROP fk_locked_by_user_id, DROP fk_attachment_id,
	DROP is_locked, CHANGE locked_date unlocked_date DATETIME DEFAULT NULL;



ALTER TABLE CC_Forum_Post ADD CONSTRAINT FK_7226C324CEB06035 FOREIGN KEY (fk_created_by_user_id) REFERENCES cc_user (id) ON DELETE SET NULL;
ALTER TABLE CC_Forum_Post ADD CONSTRAINT FK_7226C32446B4308F FOREIGN KEY (fk_edited_by_user_id) REFERENCES cc_user (id) ON DELETE SET NULL;
ALTER TABLE CC_Forum_Post ADD CONSTRAINT FK_7226C3244F5AE4DA FOREIGN KEY (fk_deleted_by_user_id) REFERENCES cc_user (id) ON DELETE SET NULL;
ALTER TABLE CC_Forum_Post ADD CONSTRAINT FK_7226C32499E721B9 FOREIGN KEY (fk_unlocked_by_user_id) REFERENCES cc_user (id) ON DELETE SET NULL;

CREATE INDEX IDX_7226C32499E721B9 ON CC_Forum_Post (fk_unlocked_by_user_id);

ALTER TABLE CC_Forum_Registry DROP FOREIGN KEY FK_156659CE3BB9921A;
ALTER TABLE CC_Forum_Registry ADD CONSTRAINT FK_18E80AC73BB9921A FOREIGN KEY (fk_owned_by_user_id) REFERENCES cc_user (id) ON DELETE SET NULL;
ALTER TABLE CC_Forum_Subscription DROP FOREIGN KEY FK_F00B98B83BB9921A;
ALTER TABLE CC_Forum_Subscription ADD fk_forum_id INT DEFAULT NULL;
ALTER TABLE CC_Forum_Subscription ADD CONSTRAINT FK_38488EA31BE4F90E FOREIGN KEY (fk_forum_id) REFERENCES cc_forum_forum (id) ON DELETE SET NULL;
ALTER TABLE CC_Forum_Subscription ADD CONSTRAINT FK_38488EA33BB9921A FOREIGN KEY (fk_owned_by_user_id) REFERENCES cc_user (id) ON DELETE SET NULL;

CREATE INDEX IDX_38488EA31BE4F90E ON CC_Forum_Subscription (fk_forum_id);

ALTER TABLE CC_Forum_Topic DROP INDEX UNIQ_B25FA063C4F1A12, ADD INDEX IDX_326269F83C4F1A12 (fk_first_post_id);
ALTER TABLE CC_Forum_Topic DROP INDEX UNIQ_B25FA06CD83D7D, ADD INDEX IDX_326269F8CD83D7D (fk_last_post_id);
ALTER TABLE CC_Forum_Topic DROP FOREIGN KEY FK_B25FA0645768453;
ALTER TABLE CC_Forum_Topic DROP FOREIGN KEY FK_B25FA064F5AE4DA;
ALTER TABLE CC_Forum_Topic DROP FOREIGN KEY FK_B25FA06D5A466FA;
ALTER TABLE CC_Forum_Topic ADD CONSTRAINT FK_326269F8D5A466FA FOREIGN KEY (fk_closed_by_user_id) REFERENCES cc_user (id) ON DELETE SET NULL;
ALTER TABLE CC_Forum_Topic ADD CONSTRAINT FK_326269F84F5AE4DA FOREIGN KEY (fk_deleted_by_user_id) REFERENCES cc_user (id) ON DELETE SET NULL;
ALTER TABLE CC_Forum_Topic ADD CONSTRAINT FK_326269F845768453 FOREIGN KEY (fk_stickied_by_user_id) REFERENCES cc_user (id) ON DELETE SET NULL


set foreign_key_checks=1;
```

- [Return back to the docs index](index.md).
